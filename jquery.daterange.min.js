// Copyright 2013 St√©phane Lavergne <http://www.imars.com/> Free software under <http://www.gnu.org/licenses/lgpl-3.0.txt>
(function(e){"use strict";e.fn.daterange=function(t){var n=e.fn.daterange.locales,a=["+1d","+7d","+14d","+0.5m","+1m","+2m","+3m","+6m","+1y","+0"],i="en",r=4,l=!1,s=!1;return t&&(t.lang&&(i=t.lang),t.ranges&&(a=t.ranges),t.initRange&&(r=t.initRange),t.previous&&(l=t.previous),t.arrowsSubmit&&(s=t.arrowsSubmit)),this.each(function(){function t(e){var t=e;return t="+"===t.charAt(0)?"-"+t.substring(1):"+"+t.substring(1)}function o(e){var t=/^(\d{4})-(\d{2})-(\d{2})$/.exec(e),n=null;return t&&(n=new Date(t[1],t[2]-1,t[3],12)),n}function u(e){var t=e.getDate(),n=e.getMonth()+1;return 10>t&&(t="0"+t),10>n&&(n="0"+n),e.getFullYear()+"-"+n+"-"+t}function d(e,t){var a="",r=0,l=0,s="";for(l=e.length,r=0;l>r;r++)e[r].search(/^Locale/)>=0?(s=e[r].substring(6),Date.prototype["get"+s]&&n[i][s]&&(a+=n[i][s][t["get"+s]()])):a+=Date.prototype["get"+e[r]]?t["get"+e[r]]():e[r];return a}function p(e,t){var n=/^([+\-])(\d+)(\.\d+)?([dmy])$/.exec(t),a=(n?n[1]:null,n?n[4]:null),i=n?parseFloat(n[1]+n[2]+(n[3]||"")):0,r=n?parseInt(n[1]+n[2],10):0,l=n&&n[3]?parseFloat(n[3]):0,s=n?parseInt(n[1]+"1",10):0,o=864e5,u=null,d=null,p=null,c=null,m=null;return"d"===a?e.setTime(e.getTime()+o*i):"m"===a?(p=e.getFullYear(),c=r%12,m=e.getMonth()+c,p+=(r-c)/12,0>m?(p--,m+=12):m>11&&(p++,m-=12),e.setFullYear(p),e.setMonth(m),0!==l&&(u=e.getTime(),d=new Date(u),m+=s,0>m?(p--,m+=12):m>11&&(p++,m-=12),d.setMonth(m),d.setFullYear(p),e.setTime(u+(d.getTime()-u)*l),2>=e.getDate()&&e.setDate(1))):"y"===a&&(0!==r&&e.setFullYear(e.getFullYear()+r),0!==l&&(u=e.getTime(),d=new Date(u),d.setFullYear(d.getFullYear()+s),e.setTime(u+(d.getTime()-u)*l))),e.setHours(12),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}function c(e,n){var a=new Date,i=1,r=t(n);if(a.setMonth(0),a.setDate(i),a.setHours(12),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),"+7d"===n||"+14d"===n)for(;0!==a.getDay();)i++,a.setDate(i);for(;e>=a;)a=p(a,n);return a=p(a,r)}function m(){var e,t=h.prop("__rule"),n=v.val();_.prop("min",n),"+0"!==t&&(n?(e=p(o(v.val()),t),e.setTime(e.getTime()-864e5),e=u(e),_.val(e),v.prop("max",e)):(_.val(n),v.prop("max",n)))}function f(){var t=v.val(),a=_.val(),r="";"+0"===h.prop("__rule")?(M.show(),D.hide()):t?(t!==a&&(r=d(n[i].format,o(t))+" - "),r+=d(n[i].format,o(a))):(b.hide(),r=e("<button>"),r.text(n[i].init).click(function(){return b.show(),"+0"!==h.prop("__rule")&&h.prepend(A),s&&h.append(S),m(),f(),s})),D.html(r)}var h=e(this),g=h.attr("data-select"),v=null,_=null,y=e("<div>"),b=e("<select>"),w=e("<strong>"),M=e("<span>"),D=e("<span>"),x=e("<button>"),F=e("<button>"),A=e("<div>"),S=e("<button>"),k=0,T=0,Y=new Date,z="";for(S.attr("type","submit").text(n[i].submit),h.find("input[type=date]").each(function(){null===v?v=e(this).detach():null===_&&(_=e(this).detach())}),v.on("change",function(){_.prop("min",e(this).val())}),_.on("change",function(){v.prop("max",e(this).val())}),h.addClass("__widget __widget_form"),b.addClass("__widget_field"),v.addClass("__widget_field"),_.addClass("__widget_field"),S.addClass("__widget_field"),v.val()&&(Y=o(v.val())),Y.setHours(12),Y.setMinutes(0),Y.setSeconds(0),Y.setMilliseconds(0),Y=c(Y,a[r]),l&&(Y=p(Y,t(a[r]))),z=u(Y),v.val(z),_.prop("min",z),A.css({display:"inline-block","margin-right":"2px"}).append(x.css("width","2em").html("&#9650;"),"<br />",F.css("width","2em").html("&#9660;")),A.find("button").css({margin:"0","border-width":"1px",background:"#f8f8f8",padding:"0","font-size":"10pt"}),h.css({display:"inline-block",border:"1px solid #cccccc","border-radius":"2px",padding:"2px","background-color":"#f8f8f8","font-family":"Arial, Helvetica, sans-serif","font-size":"12pt"}).find("*").css("font-family","Arial, Helvetica, sans-serif"),y.css({display:"inline-block"}).append(b,"<br />",w.append(M.append(v,"-",_).hide(),D)),M.css({"white-space":"nowrap"}),b.attr("name","__daterange").css({background:"#f8f8f8",border:"none",margin:"0",color:"#444444","font-size":"10pt"}),navigator.userAgent.search(/MSIE [67]/)>=0&&(h.css({display:"inline",zoom:"1"}),A.css({display:"inline",zoom:"1"}),y.css({display:"inline",zoom:"1"})),T=a.length,k=0;T>k;k++)g&&a[k]===g||!g&&k===r?(h.prop("__rule",a[k]),b.append('<option value="'+a[k]+'" selected="selected">'+n[i].rules[a[k]]+"</option>")):b.append('<option value="'+a[k]+'">'+n[i].rules[a[k]]+"</option>");b.change(function(){var n,a=e(this).find("option").filter(":selected").attr("value"),i=h.prop("__rule");h.prop("__rule",a),a!==i&&("+0"!==a&&S.detach(),"+0"===i?(v.val()&&h.prepend(A),M.hide(),D.show()):"+0"===a&&(h.find(A).detach(),h.append(S),D.hide(),M.show()),"+0"!==i&&"+0"!==a&&(n=c(o(v.val()),a),l&&(n=p(n,t(a))),v.val(u(n))),"+0"!==a&&m()),f(),"+0"!==a&&s&&e(this).closest("form").trigger("submit")}),x.click(function(){return v.val(u(p(o(v.val()),h.prop("__rule")))),m(),f(),S.detach(),s}),F.click(function(){var e=t(h.prop("__rule"));return v.val(u(p(o(v.val()),e))),m(),f(),S.detach(),s}),S.click(function(){return e(this).closest("form").trigger("submit"),e(this).detach(),!1}),h.on("setState",function(e,t){var n=b.attr("name"),a=v.attr("name"),i=_.attr("name"),r=h.prop("__rule"),l=!1;return void 0!==t[n]&&(r!==t[n]&&(b.val(t[n]),b.change(),l=!0),delete t[n]),void 0!==t[a]&&(t[a]!==v.val()&&(v.val(t[a]),_.prop("min",t[a]),l=!0),delete t[a]),void 0!==t[i]&&(t[i]!==_.val()&&(_.val(t[i]),v.prop("max",t[i]),l=!0),delete t[i]),f(),S.detach(),l}),h.on("getState",function(){var t=e(this).find('select[value!=""], input[value!=""]').serializeArray(),n={};return e.each(t,function(e,t){n[t.name]=t.value}),n}),h.empty().append(y),"+0"===h.prop("__rule")?h.append(S):v.val()&&h.prepend(A),m(),f(),s&&(S.detach(),h.append(S))})},e.fn.daterange.locales={en:{rules:{"+1d":"Daily","+7d":"Weekly","+14d":"Bi-weekly","+0.5m":"Semi-monthly","+1m":"Monthly","+2m":"Bi-monthly","+3m":"Quarterly","+6m":"Semi-yearly","+1y":"Yearly","+0":"Other..."},Month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],format:["LocaleMonth"," ","Date",", ","FullYear"],init:"Choose dates...",submit:"Apply"},fr:{rules:{"+1d":"Quotidien","+7d":"Hebdomadaire","+14d":"Deux semaines","+0.5m":"Bimensuel","+1m":"Mensuel","+2m":"Bimestriel","+3m":"Trimestriel","+6m":"Semestriel","+1y":"Annuel","+0":"Autre..."},Month:["Jan","F&eacute;v","Mars","Avr","Mai","Juin","Juil","Ao&ucirc;t","Sept","Oct","Nov","D&eacute;c"],format:["Date"," ","LocaleMonth"," ","FullYear"],init:"Choisir dates...",submit:"Appliquer"}}})(jQuery);